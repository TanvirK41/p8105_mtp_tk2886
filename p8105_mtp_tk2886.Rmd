---
title: "p8105_mtp_tk2886"
author: "Tanvir Khan"
date: 2021-10-21
output: github_document
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r echo = FALSE, message = FALSE}
library(tidyverse)
library(ggridges)
library(readxl)
library(gridExtra)
devtools::install_github("benmarwick/wordcountaddin", type = "source", dependencies = TRUE)

## Set Global Options 
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6, 
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```




# Problem 1
### Loading the p8105_mtp_data.xlsx data set, extracting specific part, cleaning the data set
```{r}
mtp_df <-
  read_excel(
    "./data/p8105_mtp_data.xlsx",
    sheet = "this one",
    range = "A9:I1230") %>%
  janitor::clean_names()
```




### Replacing numerical codes with the real representation and converting data types to the correct data types and arranging the table by gender and age (youung to old). 
```{r}
#Two important things happening: Re-coding and Changing the data type
eop_dfc <- 
  mtp_df %>%
  mutate(
     sex = recode(sex, 
                  "0" = "female", 
                  "1" = "male"),
     sex = factor(sex, levels = c(
                    "female",
                    "male")), 
     age_group = recode(age_group,
                       "2" = "18-30", 
                       "3" = "31-40", 
                       "4" = "41-50",
                       "5" = "51-60", 
                       "6" = "60+",
                       "7" = "60+", 
                       "8" = "60+"), 
     age_group = factor(age_group, levels = c(
                    "18-30", 
                    "31-40",
                    "41-50", 
                    "51-60",
                    "60+")),
    eop_size_mm = replace(eop_size_mm, is.na(eop_size_mm), "0"),
    eop_size = recode(eop_size,
                      "0" = "0-5",
                      "1" = "5-10",
                      "2" = "10-15",
                      "3" = "15-20",
                      "4" = "20-25",
                      "5" = "25+"
                      ),
    eop_size = factor(eop_size, levels = c(
                      "0-5",
                      "5-10",
                      "10-15",
                      "15-20",
                      "20-25",
                      "25+")), 
    eop_visibility_classification = recode(eop_visibility_classification,
                      "0" = "eop size 0 mm",
                      "1" = "0 < eop size mm <= 5",
                      "2" = "eop size >= 5 mm"),
    eop_visibility_classification = factor(eop_visibility_classification, levels = c(
                    "eop size 0 mm",
                    "0 < eop size mm <= 5",
                    "eop size >= 5 mm")),
    fhp_category = recode(fhp_category,
                          "0" = "0-10",
                          "1" = "10-20",
                          "2" = "20-30",
                          "3" = "30-40",
                          "4" = "40-50",
                          "5" = "50-60",
                          "6" = "60-70",
                          "7" = "70-80"),
    fhp_category = factor(fhp_category, levels = c(
                           "0-10",
                           "10-20",
                           "20-30",
                           "30-40",
                           "40-50",
                           "50-60",
                           "60-70",
                           "70-80"
    )), 
    age = as.numeric(age),
    eop_size_mm = as.numeric(eop_size_mm),
    eop_shape = as.numeric(eop_shape),
    fhp_size_mm = as.numeric(fhp_size_mm)) %>%
  arrange(sex, age)

eop_dfc
```




```{r analyzing the midterm project dataset (eop_dfc)}
eop_dim <- eop_dfc %>%
  dim()

eop_row <- eop_dfc %>%
  nrow()

eop_col <- eop_dfc %>%
  ncol()

eop_key_var <- eop_dfc %>%
  names()
```




```{r creating table to showcase the distribution of age groups, gender}
#Code for showing the count of Female and Male in each Age Group 
eop_dfc %>% 
  group_by(sex, age_group) %>% 
  summarise(
    frequency = n()) %>% 
  drop_na() %>%
  pivot_wider(
    names_from = sex,
    values_from = frequency) %>% 
  knitr::kable(col.names = c("Age Group", "Female'", "Male"))

#Code for showing the total female and male and the percentage of female and male
eop_dfc %>% 
  group_by(sex) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable(col.names = c("Age Group", "Frequency", "Percentage"))


#Code for showing the total amount of male and female in each age_group and the respective percentage
eop_dfc %>% 
  group_by(age_group) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable(col.names = c("Age Group", "Frequency", "Percentage"))
```





```{r message = FALSE}
eop_dfc %>% 
  group_by(sex, age_group) %>% 
  summarise(
    frequency = n()) %>% 
  pivot_wider(
    names_from = sex,
    values_from = frequency) %>% 
  knitr::kable(col.names = c('Age Group', 'Female', 'Male'),
               caption = "Age and Gender Distribution")


eop_dfc %>% 
  group_by(eop_visibility_classification) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()


eop_dfc %>% 
  group_by(eop_size) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()


eop_dfc %>% 
  group_by(fhp_category) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()

```





# Creating Plots to verify if the categorical variables follow the rules for their associated data 
### Age/Age Group Verification Plot 
```{r}
eop_dfc %>%
  ggplot(aes(x = age_group, y = age, color = sex)) + 
  geom_point(alpha = 0.5) +
  labs(
    title = "Age vs Age Group Category Verfication",
    x = "Age Group Category",
    y = "Age", 
    caption = "https://doi.org/10.1038/s41598-018-21625-1") +
  theme(legend.position = "right",
        legend.title = element_text(size = 9, face = "bold"),
        legend.key.size = unit(0.3, 'cm')) +
  facet_grid(~sex)
```




### FHP Size/FHP Category Verification Plot
```{r}
eop_dfc %>%
  drop_na() %>% 
  ggplot(aes(x = fhp_category, y = fhp_size_mm, color = fhp_size_mm)) +
  geom_point(alpha = 0.5) + 
  labs(
    title = "FHP Analysis Verification",
    subtitle = "Grouped by FHP Category", 
    x = "FHP Category",
    y = "FHP Size (mm)",
    caption = "https://doi.org/10.1038/s41598-018-21625-1") +
  theme(legend.position = "right",
        legend.title = element_text(size = 9, face = "bold"),
        legend.key.size = unit(0.3, 'cm')) +
  facet_grid(~sex)
```





### EOP Size Verification
```{r}
eop_dfc %>%
  drop_na() %>% 
  ggplot(aes(x = eop_size, y = eop_size_mm, color = eop_size_mm)) +
  geom_point(alpha = 0.5) + 
  labs(
    title = "EOP Size Verification",
    subtitle = "Grouped by EOP Category", 
    x = "EOP Category",
    y = "EOP Size (mm)",
    caption = "https://doi.org/10.1038/s41598-018-21625-1") +
  facet_grid(~sex)
```





# Problem 2 - Visualization
```{r}
#Showing the distribution in the boxplot 
eopdf_boxplot <-
  eop_dfc %>%
  drop_na(age_group, fhp_size_mm) %>%
  ggplot(aes(x = age_group, y = fhp_size_mm, fill = sex)) + 
  geom_boxplot() +
  labs(
    title = "FHP Distribution",
    subtitle = "Grouped by Age group",
    x = "Age Group (years)", 
    y = "Forward Head Protraction Size (mm)",
    caption = "https://doi.org/10.1038/s41598-018-21625-1") + 
  scale_x_discrete(
    labels = c("18-30 years","30's", "40's", "50's", ">60"))
eopdf_boxplot
```




```{r}
rate_plot_df <-
  eop_dfc %>%
  drop_na(age_group) %>%
  group_by(age_group, sex) %>%
  mutate(
    enlarged_filter = case_when(
      eop_size_mm > 10 ~ 1, 
      eop_size_mm <= 10 ~ 0
     )) %>%
  summarise(total = n(),
            eeop_count = sum(enlarged_filter)) %>%
  mutate(rate = eeop_count/total) %>%
  ggplot(aes(x = age_group, y = rate, color = sex)) +
  geom_line(linetype = "longdash", aes(group = sex)) +
  geom_point() +
  labs(
    title = "Enlarged EOP (EEOP) Rate", 
    subtitle = "Grouped by Gender",
    x = "Age Group", 
    y = "Rate", 
    caption = "https://doi.org/10.1038/s41598-018-21625-1") + 
  theme(legend.position = "bottom",
        legend.title = element_text(size = 9, face = "bold"),
        legend.key.size = unit(0.3, 'cm')) 

rate_plot_df
```






```{r}
grid.arrange(eopdf_boxplot, rate_plot_df, ncol = 2)
```





```{r}
#2 x 5 collection of panels that compares FHP Size versus EOP Size 
eop_dfc %>% 
  drop_na(fhp_size_mm, age_group) %>% 
  ggplot(aes(x = fhp_size_mm, y = eop_size_mm, color = sex)) +
  geom_point() +
  geom_smooth(
    method = "lm", 
    color = 'red',
    se = FALSE) +
  labs(
    title = "The association between FHP size and EOP size",
    x = "FHP Size (mm)", 
    y = "EOP Size (mm)",
    caption = "https://doi.org/10.1038/s41598-018-21625-1") +
  facet_grid(sex ~ age_group)
```



# Problem 3
```{r}
#Obtaining the total count of each age group 
eop_dfc %>% 
  filter(age_group != "NA") %>%
  group_by(age_group) %>%
  summarise(Participant_Count = n()) %>%
  knitr::kable(col.names = 
                 c("Age Group",
                   "Participant Count"))
```




```{r}
#Calculating the mean and standard deviation 
eop_dfc %>%
  summarise(Mean = round(mean(fhp_size_mm, na.rm = TRUE)), 
            Standard_Deviation = sd(fhp_size_mm, na.rm = TRUE)) %>% 
  knitr::kable()


eop_dfc %>%
  filter(age_group != "NA") %>%
  group_by(sex) %>% 
  summarise(Mean = round(mean(fhp_size_mm, na.rm = TRUE)), 
            Standard_Deviation = sd(fhp_size_mm, na.rm = TRUE)) %>% 
  knitr::kable(
    col.names = c("Sex",
                  "Mean",
                  "Standard Deviation"))

eop_dfc %>%
  filter(age_group != "NA") %>%
  group_by(age_group, sex) %>% 
  summarise(Mean = round(mean(fhp_size_mm, na.rm = TRUE)), 
            Standard_Deviation = sd(fhp_size_mm, na.rm = TRUE)) %>% 
  knitr::kable()
```




```{r}
#Calculating the Prevalence for enlarged participants out of the whole sample size 
enlarged_participants <- 
  eop_dfc %>%
  filter(eop_size_mm > 10) %>%
  nrow()

Prevalence = (enlarged_participants/nrow(eop_dfc) * 100)

Prevalence %>%
  knitr::kable(
    col.names = c("Prevalence"),
    caption = "Table shows the Prevalence of participants in the sample size with Enlarged External Occipital Protuberance")
```




```{r}
#Calculating the data of FHP among individuals with age over 60 and focusing on only FHP size of over 40mm. 
total_pop <- 
  eop_dfc %>%
  filter(age > 60 & fhp_size_mm > 40) %>% 
  nrow() 

age_sixty = 
  eop_dfc %>%
  filter(age > 60) %>% 
  nrow()

custom_data = (total_pop / age_sixty) * 100
custom_data

custom_data %>%
  knitr::kable(
    col.names = c("FHP Rate"),
    caption = "Table shows the FHP Rate among individuals over 60 and focusing on FHP size of 40mm")

count_agegrp <-
  eop_dfc %>%
  drop_na(age_group) %>%
  group_by(age_group) %>%
  summarise(agegrp = n())

over40mm_count <-
  eop_dfc %>%
  drop_na(age_group) %>%
  group_by(age_group) %>%
  filter(fhp_size_mm > 40) %>%
  summarise(over40 = n()) 

broad_trends <-
  left_join(count_agegrp, over40mm_count, by = c("age_group" = "age_group"))

broad_trends %>%
  mutate(rate = over40/agegrp)
```


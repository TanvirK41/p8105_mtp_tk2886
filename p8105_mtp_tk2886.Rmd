---
title: "p8105_mtp_tk2886"
author: "Tanvir Khan"
date: 2021-10-21
output: github_document
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = FALSE, message = FALSE}
library(tidyverse)
library(p8105.datasets)
library(ggridges)
library(readxl)
library(gridExtra)

## Set Global Options 
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6, 
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```




# Problem 1

### Loading the p8105_mtp_data.xlsx data set and cleaning the data set 
```{r}
mtp_df <-
  read_excel(
    "./data/p8105_mtp_data.xlsx",
    sheet = "this one",
    range = "A9:I1230") %>%
  janitor::clean_names()
```




### Replacing numerical codes with the real representation and converting data types to the correct data types and arranging the table by gender and age. 
```{r}
eop_dfc <- 
  mtp_df %>%
  mutate(
     sex = case_when(
       sex == "0" ~ "female", 
       sex == "1" ~ "male"),
     sex = forcats::fct_relevel(
       sex, c(
       "female",
       "male")),
     age_group = case_when(
       age_group == "2" ~ "18-30", 
       age_group == "3" ~ "31-40", 
       age_group == "4" ~ "41-50",
       age_group == "5" ~ "51-60", 
       age_group == "6" ~ "60+",
       age_group == "7" ~ "60+", 
       age_group == "8" ~ "60+"), 
     age_group = forcats::fct_relevel(
       age_group, c(
                    "18-30", 
                    "31-40",
                    "41-50", 
                    "51-60",
                    "60+")),
    eop_size_mm = replace(eop_size_mm, is.na(eop_size_mm), "0"),
    eop_size = case_when(
      eop_size == "0" ~ "0-5",
      eop_size == "1" ~ "5-10",
      eop_size == "2" ~ "10-15",
      eop_size == "3" ~ "15-20",
      eop_size == "4" ~ "20-25",
      eop_size == "5" ~ "25+"
                      ),
    eop_size = forcats::fct_relevel(
      eop_size, c(
                      "0-5",
                      "5-10",
                      "10-15",
                      "15-20",
                      "20-25",
                      "25+")), 
    eop_visibility_classification = case_when(
      eop_visibility_classification == "0" ~ "eop size 0 mm",
      eop_visibility_classification == "1" ~ "0 < eop size mm <= 5",
      eop_visibility_classification == "2" ~ "eop size >= 5 mm"),
    eop_visibility_classification = forcats::fct_relevel(
      eop_visibility_classification,
                  c(
                    "eop size 0 mm",
                    "0 < eop size mm <= 5",
                    "eop size >= 5 mm")),
    fhp_category = case_when(
      fhp_category == "0" ~ "0-10",
      fhp_category == "1" ~ "10-20",
      fhp_category == "2" ~ "20-30",
      fhp_category == "3" ~ "30-40",
      fhp_category == "4" ~ "40-50",
      fhp_category == "5" ~ "50-60",
      fhp_category == "6" ~ "60-70",
      fhp_category == "7" ~ "70-80"),
    fhp_category = forcats::fct_relevel(fhp_category, 
                          c(
                           "0-10",
                           "10-20",
                           "20-30",
                           "30-40",
                           "40-50",
                           "50-60",
                           "60-70",
                           "70-80")), 
    age = as.integer(age),
    eop_size_mm = as.double(eop_size_mm)) %>%
  arrange(sex, age)

eop_dfc
```




```{r analyzing the midterm project dataset (eop dataset)}
eop_dim <- eop_dfc %>%
  dim()

eop_row <- eop_dfc %>%
  nrow()

eop_col <- eop_dfc %>%
  ncol()

eop_key_var <- eop_dfc %>%
  names()
```
The research report describes the relationship between posture and “enlarged protuberances”, especially among younger subjects (however there are older aged participants) The research article is one of the article from 2018, Nature Scientific Reports. Originally, the dataset that was given and loaded had 1,221 participants. I have noticed in the abstract of the report, the researcher mentions that n = 1200, but there is 1,221 participants in our dataset. 

After analyzing one of the 2018 Nature Scientific Report that describes the relationship between posture and “enlarged protuberances”, especially among younger subjects, there are key components that need to be identified. This data set has **`r eop_row`**. This data set has **`r eop_col`**. The number of observations in this research study that is between ages 18-86 is **`r eop_row`**. The key variables in the dataset are **`r eop_key_var`**. 



```{r creating table to showcase the distribution of age groups, gender}
eop_dfc %>% 
  group_by(sex, age_group) %>% 
  summarise(
    frequency = n()) %>% 
  drop_na() %>%
  pivot_wider(
    names_from = sex,
    values_from = frequency) %>% 
  knitr::kable(col.names = c('Age Group', 'Female', 'Male'),
               caption = "Age and Gender Distribution.")


eop_dfc %>% 
  group_by(sex) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()

eop_dfc %>% 
  group_by(age_group) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()
```
**Table1** showcases the age group and gender distribution. The age group of 18 to 30 has the most male and female participants. 





```{r}
eop_dfc %>% 
  group_by(sex, age_group) %>% 
  summarise(
    frequency = n()) %>% 
  pivot_wider(
    names_from = sex,
    values_from = frequency) %>% 
  knitr::kable(col.names = c('Age Group', 'Female', 'Male'),
               caption = "**Table2:** Age and Gender Distribution.**")


eop_dfc %>% 
  group_by(eop_visibility_classification) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()


eop_dfc %>% 
  group_by(eop_size) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()


eop_dfc %>% 
  group_by(fhp_category) %>% 
  summarise(
    frequency = n()) %>%
    mutate(percentage = prop.table(frequency)*100) %>%
  knitr::kable()

```
**Table2:** Table 2 indicates that there is a miss-classified data in both Female and Male. The reason why the NA values were

After going through the data. There is a female participant who was classified as 17 years of age but the report abstracts states that the participants must be between the ages of 18-86. We do not know if the age was mistakenly entered. We many not assume if it the participant was truly 17 years of age and we may not put that participant in any of the other age group without first consulting with the researcher. Also there is a male participant who was classified as 45 years of age, however that participant was being grouped in the less than 18 years of age category. I did not include that participant because we do not know if 45 is really the participant's age or if it's different age without consulting with the researcher.





### Age vs Age Group Plot 
```{r}
eop_dfc %>%
  ggplot(aes(x = age_group, y = age, color = sex)) + 
  geom_point(alpha = 0.3) +
  labs(
    title = "Figure.1: Age vs Age Group Category",
    x = "Age Group Category",
    y = "Age") +
  theme(legend.position = "right",
        legend.title = element_text(size = 9, face = "bold"),
        legend.key.size = unit(0.3, 'cm')) +
  facet_grid(~sex)
```

```{r}
eop_dfc %>%
  drop_na() %>% 
  ggplot(aes(x = fhp_category, y = fhp_size_mm, color = fhp_size_mm)) +
  geom_point()
```



# Problem 2 - Visualization
```{r}
eopdf_boxplot <-
  eop_dfc %>%
  drop_na(age_group, fhp_size_mm) %>%
  ggplot(aes(x = age_group, y = fhp_size_mm, fill = sex)) + 
  geom_boxplot() +
  labs(
    title = "FHP Distribution",
    subtitle = "Grouped by Age group",
    x = "Age Group (years)", 
    y = "Forward Head Protraction Size (mm)",
    caption = "Figure 1") + 
  scale_x_discrete(
    labels = c("18-30 years","30's", "40's", "50's", ">60"))
eopdf_boxplot
```


```{r}
rate_plot_df <- 
  eop_dfc %>%
  group_by(age_group, sex) %>%
  drop_na(age_group) %>% 
  mutate(
    enlarged_filter = case_when(
      eop_size_mm > 10 ~ 'Enlarged',
      eop_size_mm <= 10 ~ 'Not Enlarged')) %>%
  count(enlarged_filter) %>%
  mutate(rate = prop.table(n)) %>%
  filter(enlarged_filter == "Enlarged") %>%
  ggplot(aes(y = rate, x = age_group, color = sex)) +
  geom_line(linetype = "dashed", aes(group = sex)) +
  geom_point() +
  labs(
    title = "Enlarged EOP (EEOP) Rate", 
    subtitle = "Grouped by Gender",
    x = "Age Group", 
    y = "Rate", 
    caption = "Figure 2") + 
  theme(legend.position = "bottom",
        legend.title = element_text(size = 9, face = "bold"),
        legend.key.size = unit(0.3, 'cm'))  
rate_plot_df
```



```{r}
grid.arrange(eopdf_boxplot, rate_plot_df, ncol = 2)
```





```{r}
eop_dfc %>% 
  #drop NA values for fhp size and age group since this is not a factor type.  
  drop_na(fhp_size_mm, age_group) %>% 
  #filter out data that has only eop size data instead of also getting data with 0's. 
  #filter(eop_size_mm != "0") %>% 
  #without color = sex, it will be harder to distinguish between gender 
  ggplot(aes(x = fhp_size_mm, y = eop_size_mm, color = sex)) +
  geom_point() +
  geom_smooth(
    method = "lm", 
    color = 'red',
    se = FALSE) +
  labs(
    x = "FHP Size (mm)", 
    y = "EOP Size (mm)",
    caption = "Data from mtp_df") +
  facet_grid(
    sex ~ age_group)
```




# Problem 3
```{r}
#Getting the total count of each age group 
eop_dfc %>% 
  filter(age_group != "NA") %>%
  group_by(age_group) %>%
  summarise(Participant_Count = n()) %>%
  knitr::kable()
```



